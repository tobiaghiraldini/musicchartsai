{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}
{{ block.super }}
<script type="text/javascript" src="{% url 'admin:jsi18n' %}"></script>
{{ media }}
<link rel="stylesheet" type="text/css" href="{% static "assets/admin-import.css" %}">
<script src="{% static "assets/admin-import.js" %}"></script>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
    &rsaquo; <a href="{% url 'admin:soundcharts_'|add:opts.model_name|add:'_changelist' %}">{{ opts.verbose_name_plural }}</a>
    &rsaquo; <a href="{% url 'admin:soundcharts_chart_change' chart.id %}">{{ chart.name }}</a>
    &rsaquo; {% trans 'Import Rankings' %}
</div>
{% endblock %}

{% block content %}
<div class="module">
    <div class="description">
        <h2>{% trans 'Import Song Rankings for' %} {{ chart.name }}</h2>
        <p>{% trans 'Fetch song rankings from the Soundcharts API for this chart.' %}</p>
    </div>

    <div class="form-row">
        <div class="field-box">
            <label for="chart_name">{% trans 'Chart Name' %}:</label>
            <input type="text" id="chart_name" value="{{ chart.name }}" readonly class="vTextField" style="background-color: #f8f9fa;">
            <p class="help">{% trans 'The name of the chart to import rankings for' %}</p>
        </div>
        
        <div class="field-box">
            <label for="platform_name">{% trans 'Platform' %}:</label>
            <input type="text" id="platform_name" value="{{ chart.platform.name|default:'Unknown' }}" readonly class="vTextField" style="background-color: #f8f9fa;">
            <p class="help">{% trans 'The platform this chart belongs to' %}</p>
        </div>
    </div>

    <div class="form-row">
        <div class="field-box">
            <label for="chart_slug">{% trans 'Chart Slug' %}:</label>
            <input type="text" id="chart_slug" value="{{ chart.slug }}" readonly class="vTextField" style="background-color: #f8f9fa;">
            <p class="help">{% trans 'The unique identifier used by the Soundcharts API' %}</p>
        </div>
        
        <div class="field-box">
            <label for="ranking_date">{% trans 'Ranking Date (Optional)' %}:</label>
            <input type="datetime-local" id="ranking_date" class="vTextField">
            <p class="help">{% trans 'Select a specific date for rankings. Leave empty to fetch the latest rankings.' %}</p>
        </div>
    </div>
    
    <div class="submit-row">
        <input type="button" value="{% trans 'Fetch Rankings from API' %}" class="default" onclick="fetchRankings()">
        <input type="button" value="{% trans 'Clear Results' %}" onclick="clearResults()">
    </div>
</div>

<div class="loading" id="loading" style="display: none;">
    <div class="module">
        <p>{% trans 'Fetching rankings from API...' %}</p>
    </div>
</div>

<div class="results-container" id="results-container" style="display: none;">
    <div class="module">
        <h2>{% trans 'API Results' %}</h2>
        
        <div class="stats" id="stats">
            <div class="stat-item">
                <div class="stat-number" id="total-entries">0</div>
                <div class="stat-label">{% trans 'Total Entries' %}</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="ranking-date">-</div>
                <div class="stat-label">{% trans 'Ranking Date' %}</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="status">-</div>
                <div class="stat-label">{% trans 'Status' %}</div>
            </div>
        </div>

        <div class="submit-row">
            <input type="button" value="{% trans 'Store Rankings in Database' %}" class="default" onclick="storeRankings()" id="store-btn">
            <input type="button" value="{% trans 'View Preview' %}" onclick="togglePreview()" id="preview-btn">
        </div>
        
        <div id="preview-container" style="display: none;">
            <h3>{% trans 'Rankings Preview' %}</h3>
            <table class="results-table" id="results-table">
                <thead>
                    <tr>
                        <th>{% trans 'Position' %}</th>
                        <th>{% trans 'Track Name' %}</th>
                        <th>{% trans 'Artist' %}</th>
                        <th>{% trans 'Weeks on Chart' %}</th>
                        <th>{% trans 'Position Change' %}</th>
                    </tr>
                </thead>
                <tbody id="results-tbody">
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}
