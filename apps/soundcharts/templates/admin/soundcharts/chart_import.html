{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
    &rsaquo; <a href="{% url 'admin:soundcharts_chart_changelist' %}">Charts</a>
    &rsaquo; {% trans 'Import Charts' %}
</div>
{% endblock %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static "admin/css/changelists.css" %}">
  <link rel="stylesheet" type="text/css" href="{% static "assets/admin-import.css" %}">
{% endblock %}

{% block extrahead %}
  {{ block.super }}
  <script src="{% static "assets/admin-import.js" %}"></script>
{% endblock %}

{% block content %}
<div class="module">
    <div class="description">
        <h2>{% trans 'Import Charts from Soundcharts Platform' %}</h2>
        <p>{% trans 'Fetch and import charts from the Soundcharts API for a specific platform.' %}</p>
    </div>

    {% if platform_code %}
        <div class="form-row">
            <div class="field-box">
                <label for="platform_name">{% trans 'Platform' %}:</label>
                <input type="text" id="platform_name" value="{{ platform_code|upper }}" readonly class="vTextField" style="background-color: #f8f9fa;">
                <p class="help">{% trans 'The platform you are importing charts for' %}</p>
            </div>
        </div>
    {% endif %}

    <!-- Fetch Charts Section -->
    <div id="fetchSection">
        <form id="fetchForm" action="{% url 'admin:soundcharts_chart_fetch' %}" method="get">
            {% csrf_token %}
            <input type="hidden" name="platform_code" value="{{ platform_code|default:'' }}">
            
            <div class="form-row">
                <div class="field-box">
                    <label for="country_code">{% trans 'Country Code' %}:</label>
                    <select name="country_code" id="country_code" class="vSelectField" required>
                        <option value="IT">Italy (IT)</option>
                        <option value="US">United States (US)</option>
                        <option value="GB">United Kingdom (GB)</option>
                        <option value="DE">Germany (DE)</option>
                        <option value="FR">France (FR)</option>
                        <option value="ES">Spain (ES)</option>
                        <option value="CA">Canada (CA)</option>
                        <option value="AU">Australia (AU)</option>
                        <option value="JP">Japan (JP)</option>
                        <option value="BR">Brazil (BR)</option>
                    </select>
                    <p class="help">{% trans 'Select the country for chart data' %}</p>
                </div>
                
                <div class="field-box">
                    <label for="limit">{% trans 'Number of Charts to Fetch' %}:</label>
                    <input type="number" name="limit" id="limit" value="50" min="1" max="200" class="vIntegerField" required>
                    <p class="help">{% trans 'Maximum 200 charts per fetch' %}</p>
                </div>
            </div>
            
            <div class="form-row">
                <div class="field-box">
                    <label for="offset">{% trans 'Offset' %}:</label>
                    <input type="number" name="offset" id="offset" value="0" min="0" class="vIntegerField" required>
                    <p class="help">{% trans 'Start from this position (useful for pagination)' %}</p>
                </div>
            </div>
        </form>
    </div>

    <!-- Loading Section -->
    <div id="loading" class="loading" style="display: none;">
        <div class="module">
            <p>{% trans 'Fetching charts from Soundcharts API...' %}</p>
        </div>
    </div>

    <!-- Charts Display Section -->
    <div id="chartsContainer" style="display: none;">
        <div class="module">
            <h2>{% trans 'Fetched Charts' %}</h2>
            
            <div class="results-container">
                <table id="chartsTable" class="results-table">
                    <thead>
                        <tr>
                            <th>{% trans 'Chart Information' %}</th>
                            <th>{% trans 'Slug' %}</th>
                            <th>{% trans 'Country' %}</th>
                            <th>{% trans 'Actions' %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Charts will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="submit-row">
        <input type="button" value="{% trans 'Fetch Charts from API' %}" class="default" onclick="fetchCharts()">
        <input type="button" value="{% trans 'Clear Results' %}" onclick="clearResults()">
    </div>
</div>
{% endblock %}
